@model IconicFund.Web.Models.AdminsListViewModel
<!--alerts-->
@{
    var sessionService = ViewBag.sessionService;
}
<div class="kt-portlet kt-portlet--mobile">
    <div class="kt-portlet__head kt-portlet__head--lg">
        <div class="kt-portlet__head-label">
            <span class="kt-portlet__head-icon"><i class="kt-font-brand flaticon2-lock"></i></span>
            <h3 class="kt-portlet__head-title">@Labels.Admins</h3>
        </div>
        <div class="kt-portlet__head-toolbar">
            <div class="kt-portlet__head-wrapper">
                <div class="kt-portlet__head-actions">
                    <a href="@Url.Content("~/Admins/Create")" class="btn btn-success btn-icon-sm">
                        @Labels.Create
                        <img src="~/Images/add.svg" alt="Create" class="img-fluid" />

                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="kt-portlet__body">
        <div class="form-row col-sm-12" style="background-color:#f5f5f5">
            <div class="col-sm-3 mb-2">
                @Html.TextBoxFor(model => model.EmplyeeNo, new { @class = "form-control form-control-sm form-filter kt-input", placeholder = Messages.SearchByEmployeeNumber })
            </div>
            <div class="col-sm-3">
                @Html.TextBoxFor(model => model.Name, new { @class = "form-control form-control-sm form-filter kt-input", placeholder = Messages.SearchByName })
            </div>
            <div class="col-sm-3">
                @Html.DropDownListFor(model => model.RoleId, Model.Roles, Labels.Select, new { @class = "form-control form-control-sm form-filter kt-input" })
            </div>
            <div class="col-sm-3">
                @Html.TextBoxFor(model => model.MobileNumber, new { @class = "form-control form-control-sm form-filter kt-input", placeholder = Messages.SearchByMobile })
            </div>
            <div class="col-sm-3">
                @Html.TextBoxFor(model => model.Email, new { @class = "form-control form-control-sm form-filter kt-input", placeholder = Messages.SearchByEmail })
            </div>
            <div class="col-sm-3">
                @Html.DropDownListFor(model => model.DepartmentCode, Model.Departments, Labels.Select, new { @class = "form-control form-control-sm form-filter kt-input" })
            </div>
            <div class="col-sm-3">
                @Html.DropDownListFor(model => model.IsActive,
                                      new SelectListItem[] {
                                          new SelectListItem{ Text = Labels.Yes, Value= "true"},
                                          new SelectListItem{ Text = Labels.No, Value= "false"}
                                      },
                                      Labels.Select, new { @class = "form-control form-control-sm form-filter kt-input" })
            </div>
            <div class="col-sm-3 mb-2">
                @Html.DropDownListFor(model => model.IsManager,
                                      new SelectListItem[] {
                                          new SelectListItem{ Text = Labels.Yes, Value= "true"},
                                          new SelectListItem{ Text = Labels.No, Value= "false"}
                                      },
                                      Labels.Select, new { @class = "form-control form-control-sm form-filter kt-input" })
            </div>
           
                <div class="col-sm-3 mt-2">
                    <button  class="btn btn-success  btn-sm kt-btn--icon"  style="margin-bottom:5px;" onclick="search()">
                        <span>@Labels.Search</span>
                    </button>
                    <button class="btn-reset btn-sm kt-btn--icon" style="margin-bottom:5px;" onclick="resetSearchElements()">
                        <span>@Labels.Reset</span>
                    </button>
                </div>
          
        </div>
        <div id="divList">
            <!-- begin: Datatable -->
            <div class="table100 ver1 ">
                <table class="table table-striped table-bordered table-hover table-checkable">
                    <thead>
                        <tr class="bg-dark" style="color:white;">
                            <th>@Labels.EmployeeNumber</th>
                            <th>@Labels.Name</th>
                            <th>@Labels.Role</th>
                            <th>@Labels.MobileNumber</th>
                            <th>@Labels.Email</th>
                            <th>@Labels.DepartmentName</th>
                            <th>@Labels.Active</th>
                            <th>@Labels.IsManager</th>
                            <th>@Labels.Actions</th>
                        </tr>
                    </thead>
                    <tbody>


                        @if (Model.Admins?.Count > 0)
                        {
                            foreach (var item in Model.Admins)
                            {
                                <tr>
                                    <td>@item.EmplyeeNo</td>
                                    <td>@string.Concat(item.FirstName, " ", item.SecondName, " ", item.ThirdName, " ", item.LastName)</td>
                                    <td>
                                        <div class="kt-list-timeline">
                                            <div class="kt-list-timeline__items">
                                                @foreach (var role in item.Roles)
                                                {
                                                    <div class="kt-list-timeline__item" style="width:auto;">
                                                        <span class="kt-list-timeline__badge"></span>
                                                        <span class="kt-list-timeline__text" style="width:auto;">@role.Role?.Name</span>
                                                    </div>
                                                }

                                            </div>
                                        </div>
                                    </td>
                                    <td>@item.MobileNumber</td>
                                    <td>@item.Email</td>


                                    <td>
                                        @if (item.IsActive)
                                        {<span class="btn btn-bold btn-sm btn-font-sm btn-label-success">@Labels.Yes</span>}
                                    else
                                    { <span class="btn btn-bold btn-sm btn-font-sm btn-label-danger">@Labels.No</span>}
                                    </td>
                                    <td>
                                        @if (item.IsManager)
                                        {<span class="btn btn-bold btn-sm btn-font-sm btn-label-success">@Labels.Yes</span>}
                                    else
                                    { <span class="btn btn-bold btn-sm btn-font-sm btn-label-danger">@Labels.No</span>}
                                    </td>
                                    <td>
                                        <a href="@Url.Content($"~/Admins/Edit/{item.Id}")" class="btn btn-sm btn-info btn-icon btn-icon-md">
                                            <i class="la la-edit"></i>
                                        </a>

                                        <a href="#"  class="btn btn-sm btn-danger btn-icon btn-icon-md" data-toggle="modal" data-target="#kt_modal_3" onclick="setDeletedItemId('@item.Id')" data-bind="@item.Id">
                                            <i class="la la-trash"></i>
                                        </a>

                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr><td colspan="7">@Messages.NoData</td></tr>
                        }
                    </tbody>
                </table>
            </div>
            <!--end: Datatable -->
            <!--begin: Pagination-->
            @if (Model.Admins?.Count > 0)
            {
                <div class="kt-pagination  kt-pagination--brand">

                    <div data-target="#divList">

                        @Html.PagedListPager(Model.Admins, page => Url.Action("Index", "Admins", new { page = page, name = Model.Name, mobileNumber = Model.MobileNumber, email = Model.Email, isActive = Model.IsActive, roleId = Model.RoleId }))

                    </div>


                </div>
            }
            <!--end: Pagination-->
        </div>
    </div>
    <!--begin::Modal-->
    <div class="modal fade" id="kt_modal_3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">@Labels.Delete @Labels.Admin</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <h5 class="kt-font-danger">@Labels.Warning</h5>
                    <p>@Messages.DeleteConfirmation</p>
                </div>
                <div class="modal-footer">
                    <a id="lnkModelDelete" class="btn btn-brand">@Labels.Yes</a>

                    <button type="button" class="btn btn-cancel" data-dismiss="modal">@Labels.Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!--end::Modal-->
</div>

<script>

    function setDeletedItemId(itemId) {

        $('#lnkModelDelete').attr('href', '/Admins/Delete/' + itemId);
    }

    function resetSearchElements() {

        var pageSize = $('#PageSize').val();

        $('#divList').load('@Url.Content("~/Admins/Index")?pageSize=' + pageSize + ' #divList');
    }

    function search() {
        debugger
        //Get the values of the filteration controls
        var EmplyeeNo = $('#EmplyeeNo').val();
        var name = $('#Name').val();
        var email = $('#Email').val();
        var mobile = $('#MobileNumber').val();


        var roleId = $('#RoleId').val();
        var isActive = $('#IsActive').val();
        var isManager = $('#IsManager').val();
        var pageSize = $('#PageSize').val();
        var departmentCode = $('#DepartmentCode').val();

        //Check if "All Roles" item is selected
        if (roleId.length == 0)
            roleId = "";    //for all roles

        //Check if none item is selected for IsActive
        if (isActive.length == 0)
            isActive = "";

        if (isManager.length == 0)
            isManager = "";

        var url = encodeURI('@Url.Content("~/Admins/Index")?roleId=' + roleId + "&isActive=" + isActive + "&EmplyeeNo=" + EmplyeeNo + "&isManager=" + isManager + "&departmentCode=" + departmentCode + "&name=" + name + '&email=' + email + '&mobileNumber=' + mobile + '&pageSize=' + pageSize);
        $('#divList').load(url + ' #divList');
    }

</script>